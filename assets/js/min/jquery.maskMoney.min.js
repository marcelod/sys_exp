/* @Copyright (c) 2011 AurÃ©lio Saraiva, Diego Plentz * @Page http://github.com/plentz/jquery-maskmoney * try at http://plentz.org/maskmoney * @Version: 1.3 * @Release: 2011-04-20*/
(function(j){j.fn.maskMoney=function(a){a=j.extend({symbol:"US$",showSymbol:!1,symbolStay:!1,thousands:",",decimal:".",precision:2,defaultZero:!0,allowZero:!1,allowNegative:!1},a);return this.each(function(){function h(c){c=c||window.event;var a=c.charCode||c.keyCode||c.which;if(void 0==a||b.attr("readonly")&&13!=a&&9!=a)return!1;if(48>a||57<a){if(45==a)return b.val(p(b)),!1;if(43==a)return b.val(b.val().replace("-","")),!1;13==a||9==a||37==a||39==a||g(c);return!0}if(b.val().length!=b.attr("maxlength")){g(c);
c=String.fromCharCode(a);var a=b.get(0),e=b.getInputSelection(a),f=e.start,e=e.end;a.value=a.value.substring(0,f)+c+a.value.substring(e,a.value.length);n(a,f+1)}return!1}function d(c){j.browser.msie&&h(c);""==b.val()||b.val()==l(m())||b.val()==a.symbol?a.allowZero?a.symbolStay?b.val(l(m())):b.val(m()):b.val(""):a.symbolStay?a.symbolStay&&b.val()==a.symbol&&b.val(l(m())):b.val(b.val().replace(a.symbol,""))}function g(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function n(a,d){var e=b.val().length;
b.val(k(a.value));var f=b.val().length;b.setCursorPosition(d-(e-f))}function k(c){c=c.replace(a.symbol,"");var b=c.length,e="",f="",d="";0!=b&&"-"==c.charAt(0)&&(c=c.replace("-",""),a.allowNegative&&(d="-"));if(0==b&&!a.defaultZero)return f;for(var g=0;g<b&&!("0"!=c.charAt(g)&&c.charAt(g)!=a.decimal);g++);for(;g<b;g++)-1!="0123456789".indexOf(c.charAt(g))&&(e+=c.charAt(g));f=parseFloat(e);f=isNaN(f)?0:f/Math.pow(10,a.precision);f=f.toFixed(a.precision);g=0==a.precision?0:1;b=(f=f.split("."))[g].substr(0,
a.precision);for(c=(f=f[0]).length;1<=(c-=3);)f=f.substr(0,c)+a.thousands+f.substr(c);return 0<a.precision?l(d+f+a.decimal+b+Array(a.precision+1-b.length).join(0)):l(d+f)}function m(){return(0/Math.pow(10,a.precision)).toFixed(a.precision).replace(RegExp("\\.","g"),a.decimal)}function l(c){return a.showSymbol&&c.substr(0,a.symbol.length)!=a.symbol?a.symbol+c:c}function p(c){return a.allowNegative?(c.val(),""!=c.val()&&"-"==c.val().charAt(0)?c.val().replace("-",""):"-"+c.val()):c.val()}var b=j(this);
b.bind("keypress.maskMoney",h);b.bind("keydown.maskMoney",function(a){a=a||window.event;var d=a.charCode||a.keyCode||a.which;if(void 0==d||b.attr("readonly")&&13!=d&&9!=d)return!1;var e=b.get(0),f=b.getInputSelection(e),h=f.start,f=f.end;return 8==d?(g(a),h==f?(e.value=e.value.substring(0,h-1)+e.value.substring(f,e.value.length),h-=1):e.value=e.value.substring(0,h)+e.value.substring(f,e.value.length),n(e,h),!1):9==d?!0:46==d||63272==d?(g(a),e.value=e.selectionStart==e.selectionEnd?e.value.substring(0,
h)+e.value.substring(f+1,e.value.length):e.value.substring(0,h)+e.value.substring(f,e.value.length),n(e,h),!1):!0});b.bind("blur.maskMoney",d);b.bind("focus.maskMoney",function(){var c=m();b.val()==c?b.val(""):""==b.val()&&a.defaultZero?b.val(l(c)):b.val(l(b.val()));this.createTextRange&&(c=this.createTextRange(),c.collapse(!1),c.select())});b.bind("mask",function(){var a=b.val();b.val(k(a))});b.one("unmaskMoney",function(){b.unbind(".maskMoney");j.browser.msie?this.onpaste=null:j.browser.mozilla&&
this.removeEventListener("input",d,!1)})})};j.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")};j.fn.mask=function(){return this.trigger("mask")};j.fn.setCursorPosition=function(a){this.each(function(h,d){if(d.setSelectionRange)d.focus(),d.setSelectionRange(a,a);else if(d.createTextRange){var g=d.createTextRange();g.collapse(!0);g.moveEnd("character",a);g.moveStart("character",a);g.select()}});return this};j.fn.getInputSelection=function(a){var h=0,d=0,g,j,k;if("number"==typeof a.selectionStart&&
"number"==typeof a.selectionEnd)h=a.selectionStart,d=a.selectionEnd;else if((j=document.selection.createRange())&&j.parentElement()==a)k=a.value.length,g=a.value.replace(/\r\n/g,"\n"),d=a.createTextRange(),d.moveToBookmark(j.getBookmark()),a=a.createTextRange(),a.collapse(!1),-1<d.compareEndPoints("StartToEnd",a)?h=d=k:(h=-d.moveStart("character",-k),h+=g.slice(0,h).split("\n").length-1,-1<d.compareEndPoints("EndToEnd",a)?d=k:(d=-d.moveEnd("character",-k),d+=g.slice(0,d).split("\n").length-1));return{start:h,
end:d}}})(jQuery);